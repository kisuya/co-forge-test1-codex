# PRD: oh-my-stock

## Overview
`oh-my-stock`은 한국/미국 주식의 급격한 가격 변동이 발생했을 때, "왜 움직였는지"를 근거와 함께 빠르게 설명해주는 이벤트 모니터링 서비스다.

## Target User
- 1차 타깃: 한국 거주 개인투자자 중 한국/미국 주식을 함께 거래하거나 모니터링하는 사용자
- 사용자 수준: 초중급 이상(차트/뉴스는 보지만 공시 해석에 시간 부족)
- 핵심 Pain Point: 변동은 보이지만 원인을 찾기 위해 여러 앱/커뮤니티를 반복 탐색해야 함

## Primary User Action
사용자가 관심 종목을 등록하면, 시스템이 급등락 이벤트를 감지하고 1분 내 원인 카드(후보 1~3개 + 근거 링크)를 전달한다.

## Core Features

### P0: Must Have
#### 1) 관심 종목 등록/관리 (KR+US)
- Description: 사용자가 검색/선택 기반 플로우로 KR/US 상장 종목을 등록하고 삭제한다.
- Acceptance criteria:
  - [ ] 사용자는 KR/US 종목을 최소 1개 이상 등록/삭제할 수 있다.
  - [ ] 같은 종목을 중복 등록하면 중복 생성 없이 기존 항목을 반환한다.
  - [ ] 종목 추가는 시드 카탈로그(또는 권위 데이터 소스) 기반 검색 결과에서만 선택 가능하며, 임의 텍스트 직접 입력으로 저장되지 않는다.
  - [ ] 자동완성, 최근 검색, market 필터를 제공해 잘못된 입력을 사전에 차단한다.
  - [ ] 미존재 심볼/시장 불일치/포맷 오류는 명시적 오류 코드와 사용자 메시지로 반환된다.
  - [ ] 종목 등록 API 응답 시간 p95가 500ms 이내다(캐시 히트 기준).

#### 2) 급등락 이벤트 감지 엔진
- Description: 분/틱 단위 가격 변화를 기준으로 이벤트를 생성한다.
- Acceptance criteria:
  - [ ] 기본 임계값(예: 5분 내 ±3%, 1일 내 ±5%) 초과 시 이벤트가 생성된다.
  - [ ] 동일 구간에서 중복 이벤트가 발생하지 않도록 디바운스 규칙이 적용된다.
  - [ ] 감지 이벤트는 UTC 타임스탬프와 거래소 타임존 정보를 함께 저장한다.

#### 3) 원인 카드 생성 (후보 1~3개 + 근거)
- Description: 공시/뉴스/기업 이벤트를 결합해 원인 후보를 점수화하고 카드로 제공한다.
- Acceptance criteria:
  - [ ] 각 이벤트는 원인 후보 1~3개를 가진다.
  - [ ] 각 후보에는 `reason_type`, `confidence_score`, `source_url`, `published_at`이 포함된다.
  - [ ] 근거 소스 URL이 1개 이상 없는 후보는 사용자에게 노출되지 않는다.

#### 4) 알림 전달 (웹 인앱 + 이메일)
- Description: 이벤트 발생 시 사용자에게 원인 카드 요약 알림을 보낸다.
- Acceptance criteria:
  - [ ] 이벤트 감지 후 60초 이내에 최소 1개 채널(인앱/이메일)로 알림이 전달된다.
  - [ ] 같은 이벤트 재알림은 최소 30분 쿨다운이 적용된다.
  - [ ] 알림에는 투자 권유 문구 없이 사실/근거 중심 텍스트만 포함된다.

#### 5) 이벤트 히스토리 조회
- Description: 사용자가 최근 이벤트와 원인 카드를 목록/상세로 조회한다.
- Acceptance criteria:
  - [ ] 최근 30일 이벤트를 종목별/날짜별 필터로 조회할 수 있다.
  - [ ] 상세 화면에서 원인 후보별 근거 링크를 클릭할 수 있다.
  - [ ] API 오류 시 사용자에게 재시도 가능한 오류 메시지를 노출한다.

### P1: Should Have
#### 1) 사용자별 임계값 커스터마이즈
- Description: 종목별 변동 임계값을 사용자 설정으로 변경.
- Acceptance criteria:
  - [ ] 기본값 외 사용자 임계값 저장/수정/초기화가 가능하다.
  - [ ] 설정 변경 후 다음 감지 사이클부터 즉시 반영된다.

#### 2) 알림 품질 피드백
- Description: 사용자 피드백(도움됨/부정확함) 수집으로 원인 점수 개선 기반 마련.
- Acceptance criteria:
  - [ ] 이벤트 카드에서 1클릭 피드백을 남길 수 있다.
  - [ ] 피드백 데이터가 이벤트/원인 후보와 연결되어 저장된다.

#### 3) 장전/장후 이벤트 라벨링
- Description: 정규장/장전/장후를 구분 표시.
- Acceptance criteria:
  - [ ] KR/US 거래소 기준으로 세션 라벨이 정확히 표시된다.

#### 4) 웹 프론트엔드 end-to-end 사용자 플로우
- Description: 사용자가 웹 화면에서 관심 종목 등록부터 이벤트 확인, 근거 링크 조회, 피드백 제출까지 완료할 수 있어야 한다.
- Acceptance criteria:
  - [ ] 가입/로그인 후 관심 종목 등록 → 이벤트 목록 조회 → 상세 확인 → 피드백 제출 흐름이 단절 없이 동작한다.
  - [ ] 이벤트 상세에서 원인 후보와 근거 URL을 클릭해 원문으로 이동할 수 있다.
  - [ ] 주요 사용자 여정에 대한 E2E 테스트가 CI에서 자동 실행된다.

#### 5) 계정 인증 및 권한 보호
- Description: 사용자별 데이터 분리를 위해 인증/인가 체계를 도입한다.
- Acceptance criteria:
  - [ ] 이메일/비밀번호 기반 가입/로그인이 가능하고 비밀번호는 안전한 해시로 저장된다.
  - [ ] 인증되지 않은 요청은 보호된 API에 접근할 수 없다.
  - [ ] watchlist, 알림, 피드백, 포트폴리오 데이터는 사용자 단위로 분리 조회된다.

#### 6) 운영 준비(실 DB/큐, 마이그레이션, 품질 게이트)
- Description: 인메모리 구현에서 벗어나 실제 운영 가능한 최소 인프라와 릴리즈 품질 게이트를 갖춘다.
- Acceptance criteria:
  - [ ] PostgreSQL/Redis 기반 저장 및 큐 처리가 로컬 도커 환경에서 재현 가능하다.
  - [ ] DB 스키마 마이그레이션이 버전 관리되며 신규 환경에서 일관되게 적용된다.
  - [ ] 백엔드/프론트엔드 테스트와 린트가 CI에서 실패 시 배포를 차단한다.

#### 7) 웹 UI 품질 상향 (로그인/대시보드)
- Description: 핵심 화면(로그인/대시보드)의 레이아웃/타이포/상태별 UI를 재설계하고, 반응형 시각 품질을 검증한다.
- Acceptance criteria:
  - [ ] 디자인 토큰(색상/타이포/간격/상태 색상)이 정의되고 로그인/대시보드에 일관 적용된다.
  - [ ] 로그인/대시보드 화면은 로딩/빈 상태/오류/성공 상태별 UI가 분리되어 제공된다.
  - [ ] 모바일(390px)과 데스크톱(1440px)에서 레이아웃 깨짐 없이 동작하며 스크린샷 또는 E2E assertion으로 검증된다.

#### 8) 기능 정의 품질 게이트
- Description: 프로젝트 실행 전 `features.json` description이 구현·검증 가능한 미니 스펙 형식을 충족하도록 강제한다.
- Acceptance criteria:
  - [ ] 모든 기능 description은 입력/출력, 성공 동작, 실패/경계조건, 사용자 피드백, 제한값을 포함한다.
  - [ ] UI 기능 description에는 레이아웃/타이포/상태별 화면/반응형 시각 수용기준과 스크린샷 또는 E2E 검증 기준이 포함된다.
  - [ ] 도메인 입력 기능 description에는 시드 카탈로그(또는 권위 데이터 소스) 검증 규칙과 오류 코드/메시지 계약이 포함된다.

#### 9) 원인 카드 근거 품질 게이트
- Description: 사용자에게 노출되는 원인 카드의 근거 URL 품질을 검증하고 저품질 근거를 자동 제외한다.
- Acceptance criteria:
  - [ ] 근거 URL은 허용 도메인/스킴 정책을 통과해야 하며, 실패한 근거는 노출 후보에서 제외된다.
  - [ ] 동일 원문 중복(동일 canonical URL 또는 동일 제목+발행시각 근접)은 1건으로 병합된다.
  - [ ] 근거 후보가 최소 기준 미만이면 카드에 "근거 수집 중" 상태를 명시하고 단정형 문구를 노출하지 않는다.

#### 10) 원인 점수 설명 투명성
- Description: 원인 카드의 confidence_score가 어떻게 계산되었는지 사용자가 이해할 수 있도록 설명 필드를 제공한다.
- Acceptance criteria:
  - [ ] 상세 화면/API에서 시간근접도·소스신뢰도·이벤트유형 가중치 등 점수 분해값을 확인할 수 있다.
  - [ ] 설명 필드 누락 시 카드 노출 대신 내부 오류로 처리하고 추적 가능한 로그를 남긴다.
  - [ ] 설명 문구는 확률형 표현을 사용하며 확정적 투자 권고 문구를 포함하지 않는다.

#### 11) 잘못된 원인 신고 및 정정 이력
- Description: 사용자가 원인 카드의 부정확함을 신고하면 재평가와 정정 이력을 추적 가능한 흐름으로 제공한다.
- Acceptance criteria:
  - [ ] 사용자는 이벤트 상세에서 원인 후보별로 부정확 신고를 제출할 수 있다.
  - [ ] 신고 접수 후 카드가 업데이트되면 수정 시각/수정 사유를 이력으로 확인할 수 있다.
  - [ ] 중복 신고/존재하지 않는 reason_id/권한 없는 접근은 명시적 오류 코드로 처리된다.

#### 12) 알림 이후 변경점(What changed) 카드
- Description: 동일 이벤트의 후속 알림은 전체 재요약 대신 이전 대비 변경점(근거 추가/점수 변화)을 중심으로 전달한다.
- Acceptance criteria:
  - [ ] 재알림에는 이전 버전 대비 추가된 근거, 제거된 근거, confidence 변화가 표시된다.
  - [ ] 변화가 임계치 미만이면 중복 알림을 억제하고 이벤트 이력만 업데이트한다.
  - [ ] 사용자 UI에서 "무엇이 바뀌었는지"를 한눈에 확인할 수 있는 델타 뷰를 제공한다.

#### 13) 개장 전/장마감 브리프
- Description: 사용자의 관심종목/보유종목 기준으로 장 시작 전과 장 마감 후 핵심 이벤트를 요약해 제공한다.
- Acceptance criteria:
  - [ ] 장 시작 전 브리프에는 오늘 확인해야 할 주요 이벤트(실적/공시/일정)와 예상 변동 리스크가 포함된다.
  - [ ] 장 마감 브리프에는 실제 발생 이벤트와 원인 카드 변화 요약이 포함된다.
  - [ ] 브리프의 각 항목은 이벤트 상세/근거 링크로 바로 이동 가능해야 하며 근거 없는 문구는 노출하지 않는다.

### P2: Nice to Have
#### 1) 포트폴리오 연동(평단/손익 영향)
- Description: 사용자의 보유 수량/평단 정보를 반영해 이벤트가 실제 손익에 주는 영향을 보여준다.
- Acceptance criteria:
  - [ ] 사용자는 종목별 보유 수량과 평균 매입가를 등록/수정할 수 있다.
  - [ ] 이벤트 상세에서 추정 손익 영향(평가손익 변화)을 확인할 수 있다.

#### 2) 모바일 푸시 알림
- Description: 인앱/이메일 외에 모바일 푸시 채널로 이벤트 알림을 전달한다.
- Acceptance criteria:
  - [ ] 사용자는 모바일 푸시 수신 동의를 설정할 수 있다.
  - [ ] 이벤트 발생 후 푸시 알림이 기존 채널과 동일한 쿨다운 규칙을 따른다.

#### 3) B2B 이벤트 API/위젯
- Description: 외부 서비스가 이벤트 데이터를 임베드/조회할 수 있는 B2B 제공 방식을 지원한다.
- Acceptance criteria:
  - [ ] API 키 기반 인증으로 이벤트 요약을 조회할 수 있다.
  - [ ] 위젯 임베드 시 원인 카드와 근거 URL이 동일하게 노출된다.

#### 4) 근거 비교 카드(상충 근거 비교)
- Description: 동일 이벤트에 대해 상충되는 근거/해석을 비교해 사용자가 편향 없이 판단할 수 있도록 돕는다.
- Acceptance criteria:
  - [ ] 이벤트 상세에서 상충 근거(예: 긍정/부정 요인)를 최소 2축으로 구분해 보여준다.
  - [ ] 각 비교 항목에는 출처 URL, 발행 시각, 핵심 요약 문구가 포함된다.
  - [ ] 비교 가능한 근거가 부족한 경우 "비교 근거 부족" 상태를 노출하고 단정형 결론을 제시하지 않는다.

## Out of Scope (v1)
- 자동매매/주문 실행
- 목표가/매수·매도 추천 등 투자자문성 기능
- 전체 소형주 유니버스 실시간 커버리지
- 커뮤니티/SNS 감성 분석 기반 예측 신호

## Success Metrics
- Activation: 가입 후 24시간 내 관심 종목 5개 이상 등록 비율 60%+
- Core action: 사용자당 주간 원인 카드 조회 5회+
- Quality: 원인 카드 피드백 중 "도움됨" 비율 70%+
- Retention: 4주차 리텐션 30%+
- Delivery: 이벤트→알림 지연 p95 60초 이내

## Constraints
- 성능: 이벤트 감지 후 알림 전달 p95 60초 이내
- 보안: 최소 수집 원칙(민감정보 미수집), 비밀번호/토큰 암호화 저장
- 컴플라이언스: "투자 조언 아님" 고지 및 근거 URL 의무 포함
- 확장성: MVP에서 KR/US 합산 1,000종목 모니터링 처리
- 일정: MVP 8~12주 내 출시

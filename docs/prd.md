# PRD: oh-my-stock

## Overview
`oh-my-stock`은 한국/미국 주식의 급격한 가격 변동이 발생했을 때, "왜 움직였는지"를 근거와 함께 빠르게 설명해주는 이벤트 모니터링 서비스다.

## Target User
- 1차 타깃: 한국 거주 개인투자자 중 한국/미국 주식을 함께 거래하거나 모니터링하는 사용자
- 사용자 수준: 초중급 이상(차트/뉴스는 보지만 공시 해석에 시간 부족)
- 핵심 Pain Point: 변동은 보이지만 원인을 찾기 위해 여러 앱/커뮤니티를 반복 탐색해야 함

## Primary User Action
사용자가 관심 종목을 등록하면, 시스템이 급등락 이벤트를 감지하고 1분 내 원인 카드(후보 1~3개 + 근거 링크)를 전달한다.

## Core Features

### P0: Must Have
#### 1) 관심 종목 등록/관리 (KR+US)
- Description: 사용자가 티커/종목명을 검색해 관심 종목을 등록하고 삭제한다.
- Acceptance criteria:
  - [ ] 사용자는 KR/US 종목을 최소 1개 이상 등록/삭제할 수 있다.
  - [ ] 같은 종목을 중복 등록하면 중복 생성 없이 기존 항목을 반환한다.
  - [ ] 종목 등록 API 응답 시간 p95가 500ms 이내다(캐시 히트 기준).

#### 2) 급등락 이벤트 감지 엔진
- Description: 분/틱 단위 가격 변화를 기준으로 이벤트를 생성한다.
- Acceptance criteria:
  - [ ] 기본 임계값(예: 5분 내 ±3%, 1일 내 ±5%) 초과 시 이벤트가 생성된다.
  - [ ] 동일 구간에서 중복 이벤트가 발생하지 않도록 디바운스 규칙이 적용된다.
  - [ ] 감지 이벤트는 UTC 타임스탬프와 거래소 타임존 정보를 함께 저장한다.

#### 3) 원인 카드 생성 (후보 1~3개 + 근거)
- Description: 공시/뉴스/기업 이벤트를 결합해 원인 후보를 점수화하고 카드로 제공한다.
- Acceptance criteria:
  - [ ] 각 이벤트는 원인 후보 1~3개를 가진다.
  - [ ] 각 후보에는 `reason_type`, `confidence_score`, `source_url`, `published_at`이 포함된다.
  - [ ] 근거 소스 URL이 1개 이상 없는 후보는 사용자에게 노출되지 않는다.

#### 4) 알림 전달 (웹 인앱 + 이메일)
- Description: 이벤트 발생 시 사용자에게 원인 카드 요약 알림을 보낸다.
- Acceptance criteria:
  - [ ] 이벤트 감지 후 60초 이내에 최소 1개 채널(인앱/이메일)로 알림이 전달된다.
  - [ ] 같은 이벤트 재알림은 최소 30분 쿨다운이 적용된다.
  - [ ] 알림에는 투자 권유 문구 없이 사실/근거 중심 텍스트만 포함된다.

#### 5) 이벤트 히스토리 조회
- Description: 사용자가 최근 이벤트와 원인 카드를 목록/상세로 조회한다.
- Acceptance criteria:
  - [ ] 최근 30일 이벤트를 종목별/날짜별 필터로 조회할 수 있다.
  - [ ] 상세 화면에서 원인 후보별 근거 링크를 클릭할 수 있다.
  - [ ] API 오류 시 사용자에게 재시도 가능한 오류 메시지를 노출한다.

### P1: Should Have
#### 1) 사용자별 임계값 커스터마이즈
- Description: 종목별 변동 임계값을 사용자 설정으로 변경.
- Acceptance criteria:
  - [ ] 기본값 외 사용자 임계값 저장/수정/초기화가 가능하다.
  - [ ] 설정 변경 후 다음 감지 사이클부터 즉시 반영된다.

#### 2) 알림 품질 피드백
- Description: 사용자 피드백(도움됨/부정확함) 수집으로 원인 점수 개선 기반 마련.
- Acceptance criteria:
  - [ ] 이벤트 카드에서 1클릭 피드백을 남길 수 있다.
  - [ ] 피드백 데이터가 이벤트/원인 후보와 연결되어 저장된다.

#### 3) 장전/장후 이벤트 라벨링
- Description: 정규장/장전/장후를 구분 표시.
- Acceptance criteria:
  - [ ] KR/US 거래소 기준으로 세션 라벨이 정확히 표시된다.

#### 4) 웹 프론트엔드 end-to-end 사용자 플로우
- Description: 사용자가 웹 화면에서 관심 종목 등록부터 이벤트 확인, 근거 링크 조회, 피드백 제출까지 완료할 수 있어야 한다.
- Acceptance criteria:
  - [ ] 가입/로그인 후 관심 종목 등록 → 이벤트 목록 조회 → 상세 확인 → 피드백 제출 흐름이 단절 없이 동작한다.
  - [ ] 이벤트 상세에서 원인 후보와 근거 URL을 클릭해 원문으로 이동할 수 있다.
  - [ ] 주요 사용자 여정에 대한 E2E 테스트가 CI에서 자동 실행된다.

#### 5) 계정 인증 및 권한 보호
- Description: 사용자별 데이터 분리를 위해 인증/인가 체계를 도입한다.
- Acceptance criteria:
  - [ ] 이메일/비밀번호 기반 가입/로그인이 가능하고 비밀번호는 안전한 해시로 저장된다.
  - [ ] 인증되지 않은 요청은 보호된 API에 접근할 수 없다.
  - [ ] watchlist, 알림, 피드백, 포트폴리오 데이터는 사용자 단위로 분리 조회된다.

#### 6) 운영 준비(실 DB/큐, 마이그레이션, 품질 게이트)
- Description: 인메모리 구현에서 벗어나 실제 운영 가능한 최소 인프라와 릴리즈 품질 게이트를 갖춘다.
- Acceptance criteria:
  - [ ] PostgreSQL/Redis 기반 저장 및 큐 처리가 로컬 도커 환경에서 재현 가능하다.
  - [ ] DB 스키마 마이그레이션이 버전 관리되며 신규 환경에서 일관되게 적용된다.
  - [ ] 백엔드/프론트엔드 테스트와 린트가 CI에서 실패 시 배포를 차단한다.

### P2: Nice to Have
#### 1) 포트폴리오 연동(평단/손익 영향)
- Description: 사용자의 보유 수량/평단 정보를 반영해 이벤트가 실제 손익에 주는 영향을 보여준다.
- Acceptance criteria:
  - [ ] 사용자는 종목별 보유 수량과 평균 매입가를 등록/수정할 수 있다.
  - [ ] 이벤트 상세에서 추정 손익 영향(평가손익 변화)을 확인할 수 있다.

#### 2) 모바일 푸시 알림
- Description: 인앱/이메일 외에 모바일 푸시 채널로 이벤트 알림을 전달한다.
- Acceptance criteria:
  - [ ] 사용자는 모바일 푸시 수신 동의를 설정할 수 있다.
  - [ ] 이벤트 발생 후 푸시 알림이 기존 채널과 동일한 쿨다운 규칙을 따른다.

#### 3) B2B 이벤트 API/위젯
- Description: 외부 서비스가 이벤트 데이터를 임베드/조회할 수 있는 B2B 제공 방식을 지원한다.
- Acceptance criteria:
  - [ ] API 키 기반 인증으로 이벤트 요약을 조회할 수 있다.
  - [ ] 위젯 임베드 시 원인 카드와 근거 URL이 동일하게 노출된다.

## Out of Scope (v1)
- 자동매매/주문 실행
- 목표가/매수·매도 추천 등 투자자문성 기능
- 전체 소형주 유니버스 실시간 커버리지
- 커뮤니티/SNS 감성 분석 기반 예측 신호

## Success Metrics
- Activation: 가입 후 24시간 내 관심 종목 5개 이상 등록 비율 60%+
- Core action: 사용자당 주간 원인 카드 조회 5회+
- Quality: 원인 카드 피드백 중 "도움됨" 비율 70%+
- Retention: 4주차 리텐션 30%+
- Delivery: 이벤트→알림 지연 p95 60초 이내

## Constraints
- 성능: 이벤트 감지 후 알림 전달 p95 60초 이내
- 보안: 최소 수집 원칙(민감정보 미수집), 비밀번호/토큰 암호화 저장
- 컴플라이언스: "투자 조언 아님" 고지 및 근거 URL 의무 포함
- 확장성: MVP에서 KR/US 합산 1,000종목 모니터링 처리
- 일정: MVP 8~12주 내 출시
